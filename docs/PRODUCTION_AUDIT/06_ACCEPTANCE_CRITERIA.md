# 06 - معايير القبول (Acceptance Criteria)

## تاريخ التدقيق: 2026-01-26

---

## 1. معايير القبول النهائية (Production Readiness)

### 1.1 معايير الأمان (Security)

| # | المعيار | الاختبار | الحالة الحالية |
|---|---------|----------|----------------|
| S-01 | العميل لا يرى بيانات عملاء آخرين | تسجيل دخول كعميل A، محاولة الوصول لبيانات عميل B | ⚠️ غير مختبر |
| S-02 | Writer لا يرى عملاء غير مسندين له | تسجيل دخول كـ writer، التحقق من البوستات المعروضة | ❌ يرى الكل |
| S-03 | Designer لا يرى عملاء غير مسندين له | تسجيل دخول كـ designer، التحقق من البوستات المعروضة | ❌ يرى الكل |
| S-04 | لا يمكن تعديل بوست مقفل (إلا admin/manager) | محاولة تعديل بوست approved كـ writer | ⚠️ يعتمد على RLS |
| S-05 | لا يمكن الوصول لـ URL بدون صلاحية | محاولة الوصول لـ `/team` كـ client | ❌ يمكن الوصول |
| S-06 | Share page محمية | محاولة الوصول لـ share URL بدون token | ❌ غير محمية |

### 1.2 معايير الوظائف (Functionality)

| # | المعيار | الاختبار | الحالة الحالية |
|---|---------|----------|----------------|
| F-01 | إنشاء بوست يعمل | إنشاء بوست جديد والتحقق من حفظه | ✅ يعمل |
| F-02 | تعديل بوست يعمل | تعديل عنوان بوست والتحقق من الحفظ | ✅ يعمل |
| F-03 | حذف بوست يعمل | حذف بوست والتحقق من اختفائه | ✅ يعمل |
| F-04 | Drag & Drop للتاريخ يعمل | سحب بوست لتاريخ آخر في Calendar | ✅ يعمل |
| F-05 | Drag & Drop للحالة يعمل | سحب بوست لعمود آخر في Kanban | ✅ يعمل |
| F-06 | الفلترة تعمل | تطبيق فلتر والتحقق من النتائج | ✅ يعمل |
| F-07 | البحث يعمل | البحث عن بوست بالعنوان | ✅ يعمل |
| F-08 | إنشاء عميل يعمل | إنشاء عميل جديد | ❌ TODO فقط |
| F-09 | إنشاء عضو فريق يعمل | إنشاء عضو جديد | ❌ TODO فقط |
| F-10 | التعليقات تُحفظ | إضافة تعليق والتحقق من حفظه | ❌ غير مربوط |
| F-11 | الموافقة/الرفض يعمل | موافقة على بوست كعميل | ⚠️ جزئي |
| F-12 | رفع الملفات يعمل | رفع صورة وربطها بالبوست | ❌ غير مربوط |

### 1.3 معايير البيانات (Data Integrity)

| # | المعيار | الاختبار | الحالة الحالية |
|---|---------|----------|----------------|
| D-01 | لا توجد بيانات ثابتة في الواجهة | مراجعة الكود للـ hardcoded data | ⚠️ بعض البيانات |
| D-02 | تغيير الشهر يعرض البوستات الصحيحة | التنقل بين الأشهر والتحقق | ✅ يعمل |
| D-03 | جميع Views تعرض نفس البيانات | مقارنة Calendar vs Grid vs Kanban | ✅ يعمل |
| D-04 | الخطة مرتبطة بالعميل والشهر | التحقق من plan_id في البوستات | ⚠️ يستخدم أول خطة |
| D-05 | البوست مرتبط بالخطة الصحيحة | إنشاء بوست والتحقق من plan_id | ⚠️ يستخدم أول خطة |

### 1.4 معايير تجربة المستخدم (UX)

| # | المعيار | الاختبار | الحالة الحالية |
|---|---------|----------|----------------|
| U-01 | الواجهة متجاوبة | اختبار على شاشات مختلفة | ✅ يعمل |
| U-02 | RTL يعمل بشكل صحيح | التحقق من اتجاه النصوص | ✅ يعمل |
| U-03 | Loading states موجودة | التحقق من skeleton loaders | ✅ يعمل |
| U-04 | Error handling واضح | التسبب في خطأ والتحقق من الرسالة | ⚠️ جزئي |
| U-05 | Success feedback موجود | إنشاء بوست والتحقق من التأكيد | ⚠️ جزئي |
| U-06 | Empty states واضحة | عرض صفحة بدون بيانات | ✅ يعمل |

---

## 2. قائمة اختبار QA (Checklist)

### 2.1 اختبارات المصادقة

```
□ تسجيل الدخول بحساب صحيح → يدخل للـ Dashboard
□ تسجيل الدخول بحساب خاطئ → رسالة خطأ
□ الوصول لصفحة محمية بدون تسجيل → توجيه لـ /login
□ تسجيل الخروج → توجيه لـ /login
□ انتهاء الجلسة → توجيه لـ /login
```

### 2.2 اختبارات الأدوار

```
Admin:
□ يرى جميع العملاء
□ يرى جميع البوستات
□ يمكنه إنشاء/تعديل/حذف أي شيء
□ يمكنه الوصول لـ /team و /clients و /settings

Manager:
□ يرى جميع العملاء
□ يرى جميع البوستات
□ يمكنه إنشاء/تعديل/حذف البوستات
□ يمكنه إرسال للمراجعة
□ يمكنه قفل/فتح البوستات

Writer:
□ يرى فقط العملاء المسندين له ← ❌ حالياً يرى الكل
□ يمكنه إنشاء بوست
□ يمكنه تعديل بوست غير مقفل
□ لا يمكنه تعديل بوست مقفل
□ لا يمكنه الوصول لـ /team و /clients

Designer:
□ يرى فقط العملاء المسندين له ← ❌ حالياً يرى الكل
□ يمكنه تعديل design_notes
□ يمكنه رفع ملفات ← ❌ غير مربوط
□ لا يمكنه تعديل النص الرئيسي

Client:
□ يُوجه لـ Client Portal ← ❌ غير موجود
□ يرى فقط بوستاته
□ يمكنه الموافقة/الرفض
□ يمكنه إضافة تعليق
□ لا يمكنه تعديل أي محتوى
```

### 2.3 اختبارات CRUD

```
Posts:
□ إنشاء بوست جديد → يظهر في جميع Views
□ تعديل عنوان البوست → يُحفظ
□ تعديل تاريخ البوست → يُحفظ
□ تعديل حالة البوست → يُحفظ
□ حذف بوست → يختفي من جميع Views
□ Drag & Drop في Calendar → يُحدث التاريخ
□ Drag & Drop في Kanban → يُحدث الحالة

Clients:
□ إنشاء عميل جديد ← ❌ TODO
□ تعديل عميل ← ❌ غير مربوط
□ حذف عميل ← ❌ غير مربوط

Team Members:
□ إنشاء عضو جديد ← ❌ TODO
□ تعديل عضو ← ❌ غير مربوط
□ حذف عضو ← ❌ غير مربوط
□ ربط عضو بعميل ← ❌ غير موجود

Comments:
□ إضافة تعليق داخلي ← ❌ غير مربوط
□ إضافة تعليق للعميل ← ❌ غير مربوط
□ العميل يرى فقط تعليقات client scope

Approvals:
□ موافقة على بوست → يُقفل ويتغير للـ approved
□ رفض بوست مع سبب → يتغير للـ rejected
```

### 2.4 اختبارات Workflow

```
□ idea → draft ✅
□ draft → design ✅
□ design → internal_review ✅
□ internal_review → client_review (manager only) ⚠️
□ client_review → approved (client only) ⚠️
□ client_review → rejected (client only) ⚠️
□ approved → scheduled ✅
□ scheduled → posted ✅
□ rejected → draft ✅

Lock/Unlock:
□ approved يُقفل البوست تلقائياً ⚠️
□ rejected يفتح القفل ⚠️
□ admin/manager يمكنهم فتح القفل يدوياً ✅
```

### 2.5 اختبارات Views

```
Calendar View:
□ يعرض البوستات في التواريخ الصحيحة ✅
□ Drag & Drop يعمل ✅
□ النقر على يوم يفتح إنشاء بوست ✅
□ التنقل بين الأشهر يعمل ✅

Grid View:
□ يعرض جميع البوستات ✅
□ النقر على بوست يفتح التعديل ✅

Kanban View:
□ يعرض البوستات في الأعمدة الصحيحة ✅
□ Drag & Drop يعمل ✅
□ قسم العمل وقسم المراجعة منفصلين ✅

List View:
□ يعرض جميع البوستات ✅
□ التحديد المتعدد يعمل ✅

Monthly Grid View:
□ يعرض البوستات مجمعة ✅
```

---

## 3. Feature Matrix

| الميزة | الحالة | المفقود | خطة الإصلاح | الملفات |
|--------|--------|---------|-------------|---------|
| **Auth** | ✅ Real | - | - | `lib/supabase/`, `middleware.ts` |
| **Tenant Isolation** | ❌ Partial | team_member_clients | Phase 1 | RLS policies |
| **RBAC** | ⚠️ Partial | Role checks in API | Phase 1 | `api/posts/*/route.ts` |
| **Client Portal** | ❌ Static | Entire portal | Phase 3 | New files |
| **Plans Monthly** | ✅ Real | Better selection | Phase 2 | `dashboard-content.tsx` |
| **Calendar View** | ✅ Real | - | - | `calendar-view.tsx` |
| **Grid View** | ✅ Real | - | - | `grid-view.tsx` |
| **List View** | ✅ Real | - | - | `list-view.tsx` |
| **Kanban View** | ✅ Real | - | - | `kanban-view.tsx` |
| **Monthly Grid** | ✅ Real | - | - | `monthly-grid-view.tsx` |
| **Post Types** | ✅ Real | - | - | `post-side-panel.tsx` |
| **Variants** | ⚠️ Partial | Save to DB | Phase 4 | `post-side-panel.tsx` |
| **Approvals** | ⚠️ Partial | Client UI | Phase 3 | `lib/actions.ts` |
| **Comments** | ❌ Static | Connect to DB | Phase 2 | `post-side-panel.tsx` |
| **Assets** | ❌ Static | Storage integration | Phase 4 | `post-side-panel.tsx` |
| **Search & Filters** | ✅ Real | - | - | `filter-panel.tsx` |
| **Team CRUD** | ❌ Static | Implement CRUD | Phase 2 | `team-content.tsx` |
| **Clients CRUD** | ❌ Static | Implement CRUD | Phase 2 | `clients-content.tsx` |

---

## 4. خطة الإكمال (Phased Completion)

### Phase 1: Security + Tenant Isolation (الأولوية القصوى)

**المدة المقدرة:** 1-2 يوم

**المهام:**
1. إنشاء جدول `team_member_clients`
2. تحديث RLS policies للـ writer/designer
3. إصلاح API routes لاستخدام الدور الحقيقي
4. إضافة role check في Middleware
5. توجيه العميل لبوابته

**Acceptance Criteria:**
- [ ] Writer يرى فقط العملاء المسندين له
- [ ] Designer يرى فقط العملاء المسندين له
- [ ] Client يُوجه لـ `/client-portal`
- [ ] API routes تستخدم الدور الحقيقي

### Phase 2: Core CRUD & Plans (الوظائف الأساسية)

**المدة المقدرة:** 2-3 أيام

**المهام:**
1. إكمال CRUD للفريق
2. إكمال CRUD للعملاء
3. إصلاح اختيار الخطة الصحيحة
4. ربط التعليقات بقاعدة البيانات
5. إضافة user_id للتعليقات

**Acceptance Criteria:**
- [ ] إنشاء/تعديل/حذف عميل يعمل
- [ ] إنشاء/تعديل/حذف عضو فريق يعمل
- [ ] ربط عضو بعميل يعمل
- [ ] التعليقات تُحفظ في DB
- [ ] الخطة الصحيحة تُختار حسب الشهر

### Phase 3: Client Portal + Approvals (بوابة العميل)

**المدة المقدرة:** 2-3 أيام

**المهام:**
1. إنشاء `/client-portal` route
2. إنشاء `ClientPortalContent` component
3. إنشاء `ClientPostView` component
4. إنشاء `ApprovalPanel` component
5. ربط الموافقة/الرفض بالـ UI

**Acceptance Criteria:**
- [ ] العميل يرى بوابته الخاصة
- [ ] العميل يرى فقط بوستاته
- [ ] العميل يمكنه الموافقة/الرفض
- [ ] العميل يمكنه إضافة تعليق
- [ ] الموافقة تقفل البوست

### Phase 4: Variants + Assets (المحتوى المتقدم)

**المدة المقدرة:** 2-3 أيام

**المهام:**
1. حفظ variants في DB
2. إعداد Supabase Storage bucket
3. إنشاء upload handler
4. ربط رفع الملفات بالـ UI
5. عرض الملفات المرفوعة

**Acceptance Criteria:**
- [ ] Variants تُحفظ لكل منصة
- [ ] رفع الملفات يعمل
- [ ] الملفات تظهر في البوست
- [ ] حذف الملفات يعمل

### Phase 5: Views Completeness (اكتمال العروض)

**المدة المقدرة:** 1 يوم

**المهام:**
1. التحقق من تناسق جميع Views
2. إضافة أي ميزات ناقصة
3. تحسين الأداء
4. إضافة pagination إذا لزم

**Acceptance Criteria:**
- [ ] جميع Views تعرض نفس البيانات
- [ ] الأداء جيد مع بيانات كثيرة
- [ ] لا توجد أخطاء في Console

### Phase 6: Polish & QA (التلميع والاختبار)

**المدة المقدرة:** 1-2 يوم

**المهام:**
1. اختبار جميع السيناريوهات
2. إصلاح أي bugs
3. تحسين error handling
4. تحسين success feedback
5. اختبار الأمان النهائي

**Acceptance Criteria:**
- [ ] جميع اختبارات QA تمر
- [ ] لا توجد أخطاء في Console
- [ ] الأمان مُختبر
- [ ] الأداء مقبول

---

## 5. Definition of Done

### المشروع يُعتبر Production-ready عندما:

1. ✅ **الأمان:**
   - لا يمكن لأي مستخدم رؤية بيانات ليست له
   - جميع API routes محمية بالدور الصحيح
   - RLS policies تعمل بشكل صحيح

2. ✅ **الوظائف:**
   - جميع CRUD operations تعمل
   - Workflow يعمل بشكل صحيح
   - Client Portal يعمل

3. ✅ **البيانات:**
   - لا توجد بيانات ثابتة في الواجهة
   - جميع البيانات من قاعدة البيانات
   - العلاقات صحيحة

4. ✅ **تجربة المستخدم:**
   - الواجهة متجاوبة
   - RTL يعمل
   - Error/Success feedback واضح

5. ✅ **الاختبار:**
   - جميع اختبارات QA تمر
   - لا توجد أخطاء في Console
   - الأداء مقبول

---

## 6. ملخص الحالة النهائية

| الفئة | النسبة الحالية | النسبة المطلوبة |
|-------|----------------|-----------------|
| الأمان | 40% | 100% |
| الوظائف | 60% | 100% |
| البيانات | 70% | 100% |
| تجربة المستخدم | 80% | 100% |
| **الإجمالي** | **62.5%** | **100%** |

### الجهد المتبقي المقدر: 8-12 يوم عمل
